<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Keto Recipes</title>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO"
    crossorigin="anonymous">

  <style media="screen">
    body {
      background: #ECEFF1;
      color: rgba(0, 0, 0, 0.87);
      font-family: Roboto, Helvetica, Arial, sans-serif;
      margin: 0;
      padding: 0;
    }

h1, h2 {margin:10px;}

    .card-body-ingredients,
    .card-body-directions {
      white-space: pre-wrap;
      margin: 10px;
    }

    .card {
      margin: 0 auto;
    }

    fieldset {
      display: grid;
      width: 15%;
      min-width: 200px;
      grid-gap: 4px;
      padding: 10px;
      margin: 10px;
    }

    img {
      max-width: 100%;
      height: auto;
    }
    #submit, #output {
      padding: 10px;
      margin: 10px;
    }
    @media (max-width: 600px) {
      body,
      #message {
        margin-top: 0;
        background: white;
        box-shadow: none;
      }
      body {
        border-top: 16px solid #ffa100;
      }
    }
  </style>
</head>

<body>
  <div id="test-data"></div>
  <h1>Keto Recipes</h1>


  <div id="output"></div>
  <h2>Add a Recipe</h2>
  <form id="myForm">
      <fieldset>
          Recipe name:
          <input type="text" id="recipeName" name="recipeName" />
          Ingredients:
          <textarea type="text" id="ingredients" name="ingredients" /></textarea>
          Directions:
          <textarea type="text" id="directions" name="directions" /></textarea>
          Link to image:
          <input type="text" id="imgLink" name="imgLink" />
          Link to recipe source:
          <input type="text" id="recipeSource" name="recipeSource" />
      </fieldset>
      <input type="submit" value="Submit" id="submit">
    </form>
  <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
    crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49"
    crossorigin="anonymous"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy"
    crossorigin="anonymous"></script>
  <script src="https://www.gstatic.com/firebasejs/4.1.3/firebase.js"></script>

  <script>
     document.addEventListener('DOMContentLoaded', function () {
            var recipeName = document.getElementById("recipeName");
            var ingredients = document.getElementById("ingredients");
            var directions = document.getElementById("directions");
            var imgLink = document.getElementById("imgLink");
            var recipeSource = document.getElementById("recipeSource");

            var form_el = document.getElementById("myForm");

            // Initialize Firebase
            const firebaseConfig = {
                apiKey: "AIzaSyAM5C9e5cfov13sVnRpzV7mTKmbscYrvbA",
                authDomain: "recipes-8b628.firebaseapp.com",
                databaseURL: "https://recipes-8b628.firebaseio.com",
                projectId: "recipes-8b628",
                storageBucket: "recipes-8b628.appspot.com",
                messagingSenderId: "144315483609",
                appId: "1:144315483609:web:9c12d4bbe79b803a0305c8",
                measurementId: "G-NETVQG5Q87"
            };

            firebase.initializeApp(firebaseConfig);

            //Array to store train data
            let newRecipes = [];
            console.log("new recipes: ", newRecipes)

            let database = firebase.database();


            database.ref().on("child_added", function (snapshot) {

                //Create new object to store snapshots and calculations
                let newData = {
                    one: snapshot.val().one,
                    two: snapshot.val().two,
                    three: snapshot.val().three,
                    four: snapshot.val().four,
                    five: newRecipes.length,
                    six: snapshot.val().six
                }
                //Push data to newRecipes array
                newRecipes.push(newData);

                //TEST NEW TABLE==============================

                let rowItems = newRecipes.map(function (p) {

                    return `<div class="card" style="width:80vw;">
<img class="card-img-top" src="`+ p.four + `" alt="Card image cap">
<div class="card-body">
<h5 class="card-title"><a href="`+ p.six + `" target="_blank">` + p.one + `</a></h5>
<div class="accordion" id="accordionExample`+ p.five + `">
<div class="card">
<div class="card-header" id="headingOne`+ p.five + `">
<h5 class="mb-0">
<button class="btn btn-link" type="button" data-toggle="collapse" data-target="#collapseOne`+ p.five + `" aria-expanded="false" aria-controls="collapseOne">
Ingredients
</button>
</h5>
</div>
<div id="collapseOne`+ p.five + `" class="collapse" aria-labelledby="headingOne` + p.five + `" data-parent="#accordionExample` + p.five + `">
<div class="card-body-ingredients">`+ p.two +
                        `</div>
</div>
</div>
<div class="card">
<div class="card-header" id="headingTwo`+ p.five + `">
<h5 class="mb-0">
<button class="btn btn-link collapsed" type="button" data-toggle="collapse" data-target="#collapseTwo`+ p.five + `" aria-expanded="false" aria-controls="collapseTwo">
Directions
</button>
</h5>
</div>
<div id="collapseTwo`+ p.five + `" class="collapse" aria-labelledby="headingTwo` + p.five + `" data-parent="#accordionExample` + p.five + `">
<div class="card-body-directions">`+ p.three +
                        `</div>
</div>
</div>
</div>
</div>
</div>`
                });
                //console.log('testing rowItems', rowItems)
                document.getElementById('output').innerHTML = rowItems;

                //=========================================================

                //Mapping data to create table
                /*let rowItems = newRecipes.map(function (p) {
                    return '<tr><td>' + p.one + '</td><td>' + p.two + '</td><td>' + p.three + '</td><td>' + p.four + '</td><td>' + p.five + '</td></tr>';
                });

                let tableHead = '<tr><th>Train Name</th><th>Destination</th><th>Frequency (min)</th><th>Next Arrival</th><th>Minutes Away</th></tr>';
                let createTable = '<table> ' + tableHead + rowItems.join('') + ' </table>';
                $(".table").html(createTable);
                // Handle the errors
            }, function (errorObject) {
                console.log("Errors handled: " + errorObject.code);
            });
*/
                

            })
            //On click submit
            form_el.addEventListener("submit", function (evt) {
                    evt.preventDefault();
                    console.log('submitted')
                    //Pull user input
                    one = document.getElementById("recipeName").value;
                    two = document.getElementById("ingredients").value;
                    three = document.getElementById("directions").value;
                    four = document.getElementById("imgLink").value;
                    six = document.getElementById("recipeSource").value;
                    five = newRecipes.length;

                    console.log('one', one)

                    //Push user input to Firebase
                    database.ref().push({
                        one: one,
                        two: two,
                        three: three,
                        four: four,
                        five: five,
                        six: six
                    });
                    console.log('recipes', newRecipes)

                    //Clear user input
                    form_el.reset();
                })
        })
    </script>
    </body>
    </html>