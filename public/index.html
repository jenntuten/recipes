<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Welcome to Firebase Hosting</title>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO"
    crossorigin="anonymous">

  <style media="screen">
    body {
      background: #ECEFF1;
      color: rgba(0, 0, 0, 0.87);
      font-family: Roboto, Helvetica, Arial, sans-serif;
      margin: 0;
      padding: 0;
    }

    .card-body-ingredients,
    .card-body-directions {
      white-space: pre-wrap;
      margin: 10px;
    }

    .card {
      margin: 0 auto;
    }

    img {
      max-width: 100%;
      height: auto;
    }

    @media (max-width: 600px) {
      body,
      #message {
        margin-top: 0;
        background: white;
        box-shadow: none;
      }
      body {
        border-top: 16px solid #ffa100;
      }
    }
  </style>
</head>

<body>
  <form id="myForm">
    <h1>Test Form</h1>
    <fieldset>
      <input type="text" id="recipeName" name="recipeName" />
      <textarea type="text" id="ingredients" name="ingredients" /></textarea>
      <textarea type="text" id="directions" name="directions" /></textarea>
      <input type="text" id="imgLink" name="imgLink" />
    </fieldset>
    <input type="submit" value="Submit">
  </form>
  <div id="output"></div>
  <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
    crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49"
    crossorigin="anonymous"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy"
    crossorigin="anonymous"></script>
  <script src="https://www.gstatic.com/firebasejs/4.1.3/firebase.js"></script>

  <script>
    document.addEventListener('DOMContentLoaded', function () {
      var recipeName = document.getElementById("recipeName");
      var ingredients = document.getElementById("ingredients");
      var directions = document.getElementById("directions");
      var imgLink = document.getElementById("imgLink");
      var form_el = document.getElementById("myForm");

      form_el.addEventListener("submit", function (evt) {
        evt.preventDefault();
        fillArray();
      });
      let testArray = [];

      function fillArray() {
        //form_el.reset();  // Reset all form data
        let testData = {
          one: recipeName.value,
          two: ingredients.value,
          three: directions.value,
          four: imgLink.value,
          five: testArray.length
        }

        //Push data to test array
        testArray.push(testData);

        console.log("test array: ", testArray);

        //Mapping data to create table
        let rowItems = testArray.map(function (p) {

          return `<div class="card" style="width:80vw;">
  <img class="card-img-top" src="`+ p.four + `" alt="Card image cap">
  <div class="card-body">
    <h5 class="card-title">`+ p.one + `</h5>
    <div class="accordion" id="accordionExample`+ p.five + `">
  <div class="card">
    <div class="card-header" id="headingOne`+ p.five + `">
      <h5 class="mb-0">
        <button class="btn btn-link" type="button" data-toggle="collapse" data-target="#collapseOne`+ p.five + `" aria-expanded="false" aria-controls="collapseOne">
          Ingredients
        </button>
      </h5>
    </div>
    <div id="collapseOne`+ p.five + `" class="collapse" aria-labelledby="headingOne` + p.five + `" data-parent="#accordionExample` + p.five + `">
      <div class="card-body-ingredients">`+ p.two +
            `</div>
    </div>
  </div>
  <div class="card">
    <div class="card-header" id="headingTwo`+ p.five + `">
      <h5 class="mb-0">
        <button class="btn btn-link collapsed" type="button" data-toggle="collapse" data-target="#collapseTwo`+ p.five + `" aria-expanded="false" aria-controls="collapseTwo">
          Directions
        </button>
      </h5>
    </div>
    <div id="collapseTwo`+ p.five + `" class="collapse" aria-labelledby="headingTwo` + p.five + `" data-parent="#accordionExample` + p.five + `">
      <div class="card-body-directions">`+ p.three +
            `</div>
    </div>
  </div>
  </div>
</div>
</div>`
        });
        //console.log('testing rowItems', rowItems)
        document.getElementById('output').innerHTML = rowItems;
        let tableHead = '<tr><th>One</th><th>Two</th><th>Three</th><th>Four</th></tr>';
        let createTable = '<table> ' + tableHead + rowItems.join('') + ' </table>';
        //console.log(createTable)
        database.ref().push({
          one: recipeName.value,
          two: ingredients.value,
          three: directions.value,
          four: imgLink.value,
          five: testArray.length
        });
        form_el.reset();
      }
      const firebaseConfig = {
        apiKey: "AIzaSyAM5C9e5cfov13sVnRpzV7mTKmbscYrvbA",
        authDomain: "recipes-8b628.firebaseapp.com",
        databaseURL: "https://recipes-8b628.firebaseio.com",
        projectId: "recipes-8b628",
        storageBucket: "recipes-8b628.appspot.com",
        messagingSenderId: "144315483609",
        appId: "1:144315483609:web:9c12d4bbe79b803a0305c8",
        measurementId: "G-NETVQG5Q87"
      };

      firebase.initializeApp(firebaseConfig);
      let recipes = [];

      firebase.database().ref('/path/to/ref').on('value', snapshot => {
        //Create new object to store snapshots
        let newData = {
          one: recipeName.value,
          two: ingredients.value,
          three: directions.value,
          four: imgLink.value,
          five: testArray.length
        }
        //Push data to recipes array
        recipes.push(newData);
        console.log("Firebase data:", newData);
      });

      // Get a reference to the database service
      var database = firebase.database();
      try {
        let app = firebase.app();
        let features = ['auth', 'database', 'messaging', 'storage'].filter(feature => typeof app[feature] === 'function');
        //document.getElementById('load').innerHTML = `Firebase SDK loaded with ${features.join(', ')}`;
      } catch (e) {
        console.error(e);
        //document.getElementById('load').innerHTML = 'Error loading the Firebase SDK, check the console.';
      }
      console.log("hey")


      database.ref().on("child_added", function (snapshot) {

        //Create new object to store snapshots
        let newData = {
          one: recipeName.value,
          two: ingredients.value,
          three: directions.value,
          four: imgLink.value,
          five: testArray.length
        }
        //Push data to recipes array
        recipes.push(newData);
        console.log("Firebase data:", newData);
      });
    });
  </script>
</body>

</html>